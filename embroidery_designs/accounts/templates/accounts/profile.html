{% extends 'base.html' %}
{% load static %}

{% block title %}Профиль пользователя{% endblock %}

{% block content %}
<div class="container mt-5 mb-5">

    <h2 class="text-center mb-4">Личный кабинет</h2>

    <div class="row">
        <!-- Левая колонка: аватар и краткие данные -->
        <div class="col-md-4 text-center">
            {% if user.profile.avatar %}
                <img src="{{ user.profile.avatar.url }}" alt="Аватар" class="img-fluid rounded-circle mb-3" width="150" height="150">
            {% else %}
                <img src="{% static 'images/default-avatar.png' %}" alt="Аватар" class="img-fluid rounded-circle mb-3" width="150" height="150">
            {% endif %}
            <h4>{{ user.username }}</h4>
            <p class="text-muted">{{ user.email }}</p>
            <p>Роль: <strong>{{ user.get_role_display }}</strong></p>

            <a href="{% url 'edit_profile' %}" class="btn btn-outline-primary btn-sm mt-2">Редактировать профиль</a>
            <a href="{% url 'password_change' %}" class="btn btn-outline-secondary btn-sm mt-2">Сменить пароль</a>
        </div>

        <!-- Правая колонка: подробности -->
        <div class="card-header">
            <h4 class="mb-0">Профиль пользователя</h4>
        </div>
        <div class="card-body">
            <p><strong>Имя пользователя:</strong> {{ user.username }}</p>
            <p><strong>Email:</strong> {{ user.email }}</p>

            <div class="text-center mt-3">
                <form method="post" action="{% url 'logout' %}" class="d-inline">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-link nav-link">
                        Выйти
                    </button>  
                </form>
            </div>
        </div>
        <div class="col-md-8">
            <h5>Информация о профиле</h5>
            <table class="table table-sm mt-3">
                <tr><th>Страна:</th><td>{{ user.profile.country|default:"—" }}</td></tr>
                <tr><th>Город:</th><td>{{ user.profile.city|default:"—" }}</td></tr>
                <tr><th>Организация:</th><td>{{ user.profile.organization|default:"—" }}</td></tr>
                <tr><th>Портфолио:</th><td>
                    {% if user.profile.portfolio_link %}
                        <a href="{{ user.profile.portfolio_link }}" target="_blank">{{ user.profile.portfolio_link }}</a>
                    {% else %}
                        —
                    {% endif %}
                </td></tr>
                <tr><th>Последняя покупка:</th><td>{{ user.profile.last_purchase_date|date:"d.m.Y H:i" }}</td></tr>
            </table>

            <h5>О себе</h5>
            <p>{{ user.profile.bio|default:"Нет описания" }}</p>

            <hr>

            <h5>Избранные дизайны</h5>
            {% if user.favorites.all %}
                <div class="row mt-3">
                    {% for fav in user.favorites.all %}
                        <div class="col-md-4 mb-3">
                            <div class="card shadow-sm">
                                <img src="{{ fav.design.preview.url }}" class="card-img-top" alt="{{ fav.design.name }}">
                                <div class="card-body">
                                    <h6>{{ fav.design.name }}</h6>
                                    <a href="{% url 'design_detail' fav.design.id %}" class="btn btn-outline-primary btn-sm">Подробнее</a>
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            {% else %}
                <p>Вы ещё не добавили дизайны в избранное.</p>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}
